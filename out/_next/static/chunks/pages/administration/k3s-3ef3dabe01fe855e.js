(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[545],{1819:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/administration/k3s",function(){return t(4495)}])},4495:function(e,n,t){"use strict";t.r(n),t.d(n,{__toc:function(){return d}});var a=t(5893),s=t(2673),o=t(3058),i=t(9812);t(6834);var r=t(2643);let d=[{depth:2,value:"Простая установка k3s",id:"простая-установка-k3s"},{depth:2,value:"Настройка путей к конфигам",id:"настройка-путей-к-конфигам"},{depth:2,value:"Установить k3s с  postgres",id:"установить-k3s-с--postgres"},{depth:2,value:"Создать БД",id:"создать-бд"},{depth:2,value:"Объединение конфигов в один файл",id:"объединение-конфигов-в-один-файл"}];function _createMdxContent(e){let n=Object.assign({h1:"h1",h2:"h2",p:"p",a:"a",pre:"pre",code:"code",span:"span",ol:"ol",li:"li"},(0,r.a)(),e.components);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.h1,{children:"Установка k3s"}),"\n",(0,a.jsx)(n.h2,{id:"простая-установка-k3s",children:"Простая установка k3s"}),"\n",(0,a.jsxs)(n.p,{children:["Ставить k3s можно последнюю или с указанием версии (как на рабочей). См. ",(0,a.jsx)(n.a,{href:"https://github.com/iconicompany/icluster/blob/master/10-k3s.sh",children:"10-k3s.sh"})]}),"\n",(0,a.jsx)(n.pre,{"data-language":"text","data-theme":"default",children:(0,a.jsxs)(n.code,{"data-language":"text","data-theme":"default",children:[(0,a.jsx)(n.span,{className:"line",children:(0,a.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"curl -sfL https://get.k3s.io | INSTALL_K3S_VERSION=v1.26.2+k3s1 sh -s - server \\"})}),"\n",(0,a.jsx)(n.span,{className:"line",children:(0,a.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:'--write-kubeconfig-mode="0640"'})})]})}),"\n",(0,a.jsx)(n.h2,{id:"настройка-путей-к-конфигам",children:"Настройка путей к конфигам"}),"\n",(0,a.jsxs)(n.p,{children:["k3s пишет конфиг в  /etc/rancher/k3s/k3s.yaml. Чтобы он стал доступен openlens, нужно скопировать его в ",(0,a.jsx)(n.code,{children:"$HOME/.kube/config"}),".\nсм. ",(0,a.jsx)(n.a,{href:"https://github.com/iconicompany/icluster/blob/master/20-config.sh",children:"20-config.sh"})]}),"\n",(0,a.jsx)(n.pre,{"data-language":"text","data-theme":"default",children:(0,a.jsxs)(n.code,{"data-language":"text","data-theme":"default",children:[(0,a.jsx)(n.span,{className:"line",children:(0,a.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"sudo groupadd -f k3s"})}),"\n",(0,a.jsx)(n.span,{className:"line",children:(0,a.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"sudo usermod -aG k3s $USER"})}),"\n",(0,a.jsx)(n.span,{className:"line",children:(0,a.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"sudo chown root:k3s /etc/rancher/k3s/k3s.yaml"})}),"\n",(0,a.jsx)(n.span,{className:"line",children:(0,a.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"mkdir -p $HOME/.kube"})}),"\n",(0,a.jsx)(n.span,{className:"line",children:(0,a.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"sudo cp /etc/rancher/k3s/k3s.yaml $HOME/.kube/config"})}),"\n",(0,a.jsx)(n.span,{className:"line",children:(0,a.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"sudo chown $USER $HOME/.kube/config"})}),"\n",(0,a.jsx)(n.span,{className:"line",children:(0,a.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"sudo chmod og-rwx $HOME/.kube/config"})})]})}),"\n",(0,a.jsx)(n.h2,{id:"установить-k3s-с--postgres",children:"Установить k3s с  postgres"}),"\n",(0,a.jsxs)(n.p,{children:["В рабочей среде лучше ставить вариант с базой в Postgres, см. ",(0,a.jsx)(n.a,{href:"https://github.com/iconicompany/icluster/blob/master/10-k3s-pg.sh",children:"10-k3s-pg.sh"})]}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["Установить зависимости ",(0,a.jsx)(n.code,{children:"sudo apt install postgresql postgresql-client"})]}),"\n",(0,a.jsxs)(n.li,{children:["Настроить доступ к БД из сети см. ",(0,a.jsx)(n.a,{href:"https://github.com/iconicompany/icluster/blob/master/database/postgres.sh",children:"postgres.sh"})]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"создать-бд",children:"Создать БД"}),"\n",(0,a.jsx)(n.h2,{id:"объединение-конфигов-в-один-файл",children:"Объединение конфигов в один файл"}),"\n",(0,a.jsxs)(n.p,{children:["В переменной KUBECONFIG прописать через : пути к файлам конфигурации и выполнить команду  ",(0,a.jsx)(n.code,{children:"kubectl config view --flatten"})]}),"\n",(0,a.jsx)(n.pre,{"data-language":"text","data-theme":"default",children:(0,a.jsxs)(n.code,{"data-language":"text","data-theme":"default",children:[(0,a.jsx)(n.span,{className:"line",children:(0,a.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"export KUBECONFIG=`ls -d $DEST/* | tr '\\n' ':'`"})}),"\n",(0,a.jsx)(n.span,{className:"line",children:(0,a.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"kubectl config view --flatten > $DEST/config"})}),"\n",(0,a.jsx)(n.span,{className:"line",children:(0,a.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"mv $DEST/config -f $HOME/.kube/config"})})]})})]})}let c={MDXContent:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,r.a)(),e.components);return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(_createMdxContent,{...e})}):_createMdxContent(e)},pageOpts:{filePath:"pages/administration/k3s.md",route:"/administration/k3s",timestamp:1692246332e3,pageMap:[{kind:"Meta",data:{index:"Introduction",development:"Разработка",administration:"Servers, databases, clusters","project-catalogue":"Каталог проектов",onboarding:"Onboarding for DEVELOPER","project-managment":"Управление проектами",contact:{title:"Contact ↗",type:"page",href:"https://iconicompany.com/",newWindow:!0}}},{kind:"Folder",name:"administration",route:"/administration",children:[{kind:"Meta",data:{server:"Как создать и настроить сервер на Ubuntu",k3s:"Установка k3s",ldap:"Ldap",putting:"Putting",werf:"Werf"}},{kind:"MdxPage",name:"k3s",route:"/administration/k3s"},{kind:"MdxPage",name:"ldap",route:"/administration/ldap"},{kind:"MdxPage",name:"putting",route:"/administration/putting"},{kind:"MdxPage",name:"server",route:"/administration/server"},{kind:"MdxPage",name:"werf",route:"/administration/werf"}]},{kind:"Folder",name:"development",route:"/development",children:[{kind:"Meta",data:{guidelines:"Гайдлайны",nodejs:"Nodejs docs",telegram:"Telegram"}},{kind:"Folder",name:"guidelines",route:"/development/guidelines",children:[{kind:"Meta",data:{dod:"Definition of Done",recommendations:"Recommendations"}},{kind:"MdxPage",name:"dod",route:"/development/guidelines/dod"},{kind:"MdxPage",name:"recommendations",route:"/development/guidelines/recommendations"}]},{kind:"Folder",name:"nodejs",route:"/development/nodejs",children:[{kind:"Meta",data:{workstation:"How to setup Nodejs developer workstation",packages:"Snippets for packages"}},{kind:"MdxPage",name:"packages",route:"/development/nodejs/packages"},{kind:"MdxPage",name:"workstation",route:"/development/nodejs/workstation"}]},{kind:"MdxPage",name:"telegram",route:"/development/telegram"}]},{kind:"MdxPage",name:"index",route:"/"},{kind:"MdxPage",name:"onboarding",route:"/onboarding"},{kind:"Folder",name:"project-catalogue",route:"/project-catalogue",children:[{kind:"Meta",data:{bystrobank:"БыстроБанк"}},{kind:"Folder",name:"bystrobank",route:"/project-catalogue/bystrobank",children:[{kind:"Meta",data:{guidelines:"Гайдлайны",stubs:"Написание заглушек"}},{kind:"MdxPage",name:"guidelines",route:"/project-catalogue/bystrobank/guidelines"},{kind:"MdxPage",name:"stubs",route:"/project-catalogue/bystrobank/stubs"}]}]},{kind:"Folder",name:"project-managment",route:"/project-managment",children:[{kind:"Folder",name:"NUPP_p3express",route:"/project-managment/NUPP_p3express",children:[{kind:"MdxPage",name:"NUPP-principles",route:"/project-managment/NUPP_p3express/NUPP-principles"},{kind:"Meta",data:{"NUPP-principles":"Nupp Principles"}}]},{kind:"MdxPage",name:"PMBOK6",route:"/project-managment/PMBOK6"},{kind:"Meta",data:{onboarding_pm:"База",work:"Управление проектом",issue:"Постановка issue",escalation:"Эскалация на проекте",requirements:"Оформление задач и требований",integration:"Управление интеграцией",developmentprocess:"Developmentprocess",PMBOK6:"Pmbok6",productmanagement:"Productmanagement"}},{kind:"MdxPage",name:"developmentprocess",route:"/project-managment/developmentprocess"},{kind:"MdxPage",name:"escalation",route:"/project-managment/escalation"},{kind:"MdxPage",name:"integration",route:"/project-managment/integration"},{kind:"MdxPage",name:"issue",route:"/project-managment/issue"},{kind:"MdxPage",name:"onboarding_pm",route:"/project-managment/onboarding_pm"},{kind:"MdxPage",name:"productmanagement",route:"/project-managment/productmanagement"},{kind:"MdxPage",name:"work",route:"/project-managment/work"}]}],flexsearch:{codeblocks:!0},title:"Установка k3s",headings:d},pageNextRoute:"/administration/k3s",nextraLayout:o.ZP,themeConfig:i.Z};n.default=(0,s.j)(c)},9812:function(e,n,t){"use strict";var a=t(5893);t(7294);let s={logo:(0,a.jsx)("span",{children:"Iconicompany docs"}),project:{link:"https://github.com/iconicompany/idocs"},chat:{link:"https://t.me/iconicompany"},docsRepositoryBase:"https://github.com/iconicompany/idocs/blob/main",footer:{text:"Iconicompany docs"}};n.Z=s}},function(e){e.O(0,[774,270,888,179],function(){return e(e.s=1819)}),_N_E=e.O()}]);