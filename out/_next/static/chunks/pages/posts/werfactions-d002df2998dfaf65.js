(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[155],{5177:function(e,n,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/posts/werfactions",function(){return s(8951)}])},8951:function(e,n,s){"use strict";s.r(n),s.d(n,{__toc:function(){return l}});var t=s(5893),a=s(2673),i=s(3058),r=s(8426);s(9128);var o=s(2643);let l=[{depth:3,value:"Преимущества Kubernetes",id:"преимущества-kubernetes"},{depth:4,value:"1. Изоляция с помощью Namespaces",id:"1-изоляция-с-помощью-namespaces"},{depth:4,value:"2. Горизонтальное масштабирование",id:"2-горизонтальное-масштабирование"},{depth:4,value:"3. Управление конфигурациями с помощью Helm / Werf",id:"3-управление-конфигурациями-с-помощью-helm--werf"},{depth:4,value:"Выкладка в продакшен из тэга:",id:"выкладка-в-продакшен-из-тэга"},{depth:4,value:"Пример выкладки Pull Request",id:"пример-выкладки-pull-request"},{depth:3,value:"Запуск авто-тестов в библиотеке Playwright",id:"запуск-авто-тестов-в-библиотеке-playwright"},{depth:4,value:"1. Установка Playwright",id:"1-установка-playwright"},{depth:4,value:"2. Настройка и запуск тестов",id:"2-настройка-и-запуск-тестов"},{depth:4,value:"3. Возвращение результатов",id:"3-возвращение-результатов"}];function _createMdxContent(e){let n=Object.assign({p:"p",h3:"h3",h4:"h4",a:"a",pre:"pre",code:"code",span:"span"},(0,o.a)(),e.components);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"В мире современной разработки программного обеспечения процесс интеграции и развертывания нового кода стал намного более сложным и требовательным к автоматизации. Для упрощения этого процесса и обеспечения надежности развертывания, многие команды разработчиков обращаются к Kubernetes. В этой статье мы рассмотрим, почему Kubernetes стал популярным инструментом для развертывания веток и Pull Request'ов разработчиков."}),"\n",(0,t.jsx)(n.h3,{id:"преимущества-kubernetes",children:"Преимущества Kubernetes"}),"\n",(0,t.jsx)(n.h4,{id:"1-изоляция-с-помощью-namespaces",children:"1. Изоляция с помощью Namespaces"}),"\n",(0,t.jsx)(n.p,{children:"Kubernetes предоставляет мощный механизм изоляции, который позволяет каждой ветке кода и Pull Request'у работать в собственном изолированном пространстве. Это достигается с помощью концепции Namespaces. Namespaces позволяют разграничить ресурсы, такие как CPU, память, сеть и хранилище, между различными ветками кода и Pull Request'ами. Это обеспечивает высокую степень безопасности и изоляции, предотвращая возможные конфликты и помогая избежать взаимных влияний."}),"\n",(0,t.jsx)(n.h4,{id:"2-горизонтальное-масштабирование",children:"2. Горизонтальное масштабирование"}),"\n",(0,t.jsx)(n.p,{children:"Одним из ключевых преимуществ Kubernetes является его способность горизонтального масштабирования. Это означает, что вы можете легко управлять различными ветками кода и Pull Request'ами, увеличивая или уменьшая количество ресурсов, выделенных каждому из них, в зависимости от их нагрузки. Это делает Kubernetes идеальным инструментом для работы с разнообразными проектами и командами разработчиков, где требуется гибкость в управлении ресурсами."}),"\n",(0,t.jsx)(n.h4,{id:"3-управление-конфигурациями-с-помощью-helm--werf",children:"3. Управление конфигурациями с помощью Helm / Werf"}),"\n",(0,t.jsx)(n.p,{children:"Для управления конфигурациями при развертывании веток кода и Pull Request'ов можно использовать Helm - пакетный менеджер для Kubernetes. Helm позволяет создавать чарты, которые определяют, какие ресурсы должны быть созданы и какие параметры конфигурации использовать. Это упрощает процесс развертывания и позволяет быстро вносить изменения в конфигурацию при необходимости.\nОднако работать напрямую с Helm не очень удобно. Для упрощения развертывания мы создали набор шаблонов для Werf и настроили Github Actions для запуска данных процессов."}),"\n",(0,t.jsxs)(n.p,{children:["Все наши шаблоны размещены в публичном репозитории ",(0,t.jsx)(n.a,{href:"https://github.com/iconicompany/werfactions",children:"https://github.com/iconicompany/werfactions"}),", но если вы хотите их использовать, вам лучше сделать локальный fork."]}),"\n",(0,t.jsx)(n.p,{children:"Пример использования в github actions:"}),"\n",(0,t.jsx)(n.h4,{id:"выкладка-в-продакшен-из-тэга",children:"Выкладка в продакшен из тэга:"}),"\n",(0,t.jsx)(n.pre,{"data-language":"text","data-theme":"default",children:(0,t.jsxs)(n.code,{"data-language":"text","data-theme":"default",children:[(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"name: Production Deployment"})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"on:"})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"  push:"})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"    tags: ['*']"})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"jobs:"})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"  call-converge:"})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"    uses: iconicompany/werfactions/.github/workflows/deployment.yml@main"})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"    secrets: inherit"})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"    with:"})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"      registry: registry.gitlab.com"})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"      context: production"})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"      environment: production"})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"      domain: iconicompany.ru"})})]})}),"\n",(0,t.jsx)(n.h4,{id:"пример-выкладки-pull-request",children:"Пример выкладки Pull Request"}),"\n",(0,t.jsxs)(n.p,{children:["Выкладка PR происходит в момент добавления метки ",(0,t.jsx)(n.code,{children:"review"})," в Pull Request, при снятии метки или закрытия PR ресурсы освобождаются"]}),"\n",(0,t.jsx)(n.pre,{"data-language":"text","data-theme":"default",children:(0,t.jsxs)(n.code,{"data-language":"text","data-theme":"default",children:[(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"name: Pull Request Deployment"})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"on: pull_request"})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"jobs:"})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"}})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"  call-converge:"})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"    uses: iconicompany/werfactions/.github/workflows/deployment.yml@main"})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"    secrets: inherit"})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"    with:"})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"      registry: registry.gitlab.com"})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"      context: testing"})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"      environment: ${{ github.head_ref || github.ref_name }}"})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"      domain: ${{ github.head_ref || github.ref_name }}.${{ github.repository_owner }}.icncd.ru"})}),"\n",(0,t.jsx)(n.span,{className:"line",children:(0,t.jsx)(n.span,{style:{color:"var(--shiki-color-text)"}})})]})}),"\n",(0,t.jsx)(n.h3,{id:"запуск-авто-тестов-в-библиотеке-playwright",children:"Запуск авто-тестов в библиотеке Playwright"}),"\n",(0,t.jsx)(n.p,{children:"После развертывания веток кода и Pull Request'ов на кластере Kubernetes, важно удостовериться в их надежности и стабильности. Для этого часто используют автоматизированные тесты, и в этом контексте библиотека Playwright может быть идеальным выбором."}),"\n",(0,t.jsx)(n.h4,{id:"1-установка-playwright",children:"1. Установка Playwright"}),"\n",(0,t.jsx)(n.p,{children:"Для начала необходимо установить библиотеку Playwright в Kubernetes-кластере. Это можно сделать с помощью Docker-образов, содержащих необходимые зависимости. Образы могут быть созданы с использованием инструментов управления конфигурацией, таких как Helm, для облегчения процесса установки и обновления."}),"\n",(0,t.jsx)(n.h4,{id:"2-настройка-и-запуск-тестов",children:"2. Настройка и запуск тестов"}),"\n",(0,t.jsx)(n.p,{children:"Playwright предоставляет обширный набор инструментов для автоматизации браузерных тестов. Тесты могут быть настроены для выполнения на каждой ветке кода или Pull Request'е. Например, при создании Pull Request'а, автоматизированные тесты могут быть запущены для проверки, не вызывает ли новый код проблем на уровне пользовательского интерфейса или функциональности."}),"\n",(0,t.jsx)(n.h4,{id:"3-возвращение-результатов",children:"3. Возвращение результатов"}),"\n",(0,t.jsx)(n.p,{children:"После выполнения авто-тестов, результаты могут быть возвращены в систему управления разработкой, такую как GitHub или GitLab. Это позволяет разработчикам получать быструю обратную связь о качестве своего кода и делать необходимые корректировки до момента слияния изменений."}),"\n",(0,t.jsx)(n.p,{children:"Использование Kubernetes для развертывания веток кода и Pull Request'ов, а также интеграция библиотеки Playwright для авто-тестирования, позволяют значительно упростить и ускорить процесс разработки и развертывания, обеспечивая при этом высокую степень изоляции и безопасности. Эти инструменты способствуют автоматизации и улучшению качества кода, что важно для современных команд разработчиков, стремящихся к более эффективному и надежному процессу разработки ПО."})]})}let c={MDXContent:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,o.a)(),e.components);return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(_createMdxContent,{...e})}):_createMdxContent(e)},pageOpts:{filePath:"pages/posts/werfactions.md",route:"/posts/werfactions",pageMap:[{kind:"Meta",data:{index:"Introduction",development:"Разработка",administration:"Servers, databases, clusters","project-catalogue":"Каталог проектов",onboarding:"Onboarding for DEVELOPER","project-managment":"Управление проектами",posts:"Статьи, заметки, посты",contact:{title:"Contact ↗",type:"page",href:"https://iconicompany.ru/",newWindow:!0}}},{kind:"Folder",name:"administration",route:"/administration",children:[{kind:"Meta",data:{server:"Как создать и настроить сервер на Ubuntu",k3s:"Установка k3s",ldap:"Ldap",putting:"Putting",werf:"Werf"}},{kind:"MdxPage",name:"k3s",route:"/administration/k3s"},{kind:"MdxPage",name:"ldap",route:"/administration/ldap"},{kind:"MdxPage",name:"putting",route:"/administration/putting"},{kind:"MdxPage",name:"server",route:"/administration/server"},{kind:"MdxPage",name:"werf",route:"/administration/werf"}]},{kind:"Folder",name:"development",route:"/development",children:[{kind:"Meta",data:{guidelines:"Гайдлайны",nodejs:"Nodejs docs",telegram:"Telegram"}},{kind:"Folder",name:"guidelines",route:"/development/guidelines",children:[{kind:"Meta",data:{dod:"Definition of Done",recommendations:"Recommendations"}},{kind:"MdxPage",name:"dod",route:"/development/guidelines/dod"},{kind:"MdxPage",name:"recommendations",route:"/development/guidelines/recommendations"}]},{kind:"Folder",name:"nodejs",route:"/development/nodejs",children:[{kind:"Meta",data:{workstation:"How to setup Nodejs developer workstation",packages:"Snippets for packages"}},{kind:"MdxPage",name:"packages",route:"/development/nodejs/packages"},{kind:"MdxPage",name:"workstation",route:"/development/nodejs/workstation"}]},{kind:"MdxPage",name:"telegram",route:"/development/telegram"}]},{kind:"MdxPage",name:"index",route:"/"},{kind:"MdxPage",name:"onboarding",route:"/onboarding"},{kind:"Folder",name:"posts",route:"/posts",children:[{kind:"Meta",data:{werfactions:"Kubernetes для развертывания веток и Pull Request"}},{kind:"MdxPage",name:"werfactions",route:"/posts/werfactions"}]},{kind:"Folder",name:"project-catalogue",route:"/project-catalogue",children:[{kind:"Meta",data:{bystrobank:"БыстроБанк"}},{kind:"Folder",name:"bystrobank",route:"/project-catalogue/bystrobank",children:[{kind:"Meta",data:{guidelines:"Гайдлайны",stubs:"Написание заглушек"}},{kind:"MdxPage",name:"guidelines",route:"/project-catalogue/bystrobank/guidelines"},{kind:"MdxPage",name:"stubs",route:"/project-catalogue/bystrobank/stubs"}]}]},{kind:"Folder",name:"project-managment",route:"/project-managment",children:[{kind:"Folder",name:"NUPP_p3express",route:"/project-managment/NUPP_p3express",children:[{kind:"MdxPage",name:"NUPP-principles",route:"/project-managment/NUPP_p3express/NUPP-principles"},{kind:"Meta",data:{"NUPP-principles":"Nupp Principles"}}]},{kind:"MdxPage",name:"PMBOK6",route:"/project-managment/PMBOK6"},{kind:"Meta",data:{onboarding_pm:"База",work:"Управление проектом",issue:"Постановка issue",escalation:"Эскалация на проекте",requirements:"Оформление задач и требований",integration:"Управление интеграцией",developmentprocess:"Developmentprocess",PMBOK6:"Pmbok6",productmanagement:"Productmanagement"}},{kind:"MdxPage",name:"developmentprocess",route:"/project-managment/developmentprocess"},{kind:"MdxPage",name:"escalation",route:"/project-managment/escalation"},{kind:"MdxPage",name:"integration",route:"/project-managment/integration"},{kind:"MdxPage",name:"issue",route:"/project-managment/issue"},{kind:"MdxPage",name:"onboarding_pm",route:"/project-managment/onboarding_pm"},{kind:"MdxPage",name:"productmanagement",route:"/project-managment/productmanagement"},{kind:"MdxPage",name:"work",route:"/project-managment/work"}]}],flexsearch:{codeblocks:!0},title:"Werfactions",headings:l},pageNextRoute:"/posts/werfactions",nextraLayout:i.ZP,themeConfig:r.Z};n.default=(0,a.j)(c)},8426:function(e,n,s){"use strict";var t=s(5893);s(7294);let a={logo:(0,t.jsx)("span",{children:"Iconicompany docs"}),project:{link:"https://github.com/iconicompany/idocs"},chat:{link:"https://t.me/iconicompany"},docsRepositoryBase:"https://github.com/iconicompany/idocs/blob/main",footer:{text:"Iconicompany docs"}};n.Z=a}},function(e){e.O(0,[774,59,888,179],function(){return e(e.s=5177)}),_N_E=e.O()}]);